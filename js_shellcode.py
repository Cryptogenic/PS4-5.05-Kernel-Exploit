#!/usr/bin/env python
from struct import pack,unpack
import argparse

def swap32(i):
  return unpack("<I", pack(">I", i))[0]

parser = argparse.ArgumentParser(description=__doc__, formatter_class=argparse.ArgumentDefaultsHelpFormatter)
parser.add_argument("file", type=str, type=argparse.FileType('rb'), help="specify binary file")
parser.add_argument("buffer", type=str, help="name of buffer to write shellcode to")
parser.add_argument("-b", "--blocksize", type=int, required=False, default=30000, help="specify block size")
args = parser.parse_args()
assert args.blocksize > 0, "block size must be positive"

block = args.file.read(args.blocksize)
hexStr = ""
for blockOffset,ch in enumerate(block):
  hexStr += format((ord(ch)), 'x').zfill(2)
  if blockOffset % 4 == 0:
    hexStr += "|"

for byteIndex,byteSet in enumerate(hexStr.split('|')[:-1]):
  byte = int(byteSet, 16)
  byte = format(swap32(byte), 'x').zfill(8) # Little Endian Pls
  print("p.write4(%s.add32(0x%s), 0x);" % (args.buffer, str(format((byteIndex*4), 'x').zfill(8)), str(byte)))
